<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun Stats - Kurd vs Arab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #1a1a1a; color: #fff; }
        .kurd-bg { background: linear-gradient(135deg, #e42222, #24903c); }
        .arab-bg { background: linear-gradient(135deg, #2a2a2a, #007a3d); }
        .stat-card { background-color: rgba(0,0,0,0.2); border-radius: 0.75rem; padding: 1.5rem; text-align: center; }
        .stat-value { font-size: 3rem; font-weight: 900; }
        .stat-label { font-size: 1rem; opacity: 0.8; }
        .player-card { background-color: rgba(0,0,0,0.3); border-radius: 0.75rem; padding: 1.5rem; text-align: center; }
        .player-avatar { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid #fff; margin: 0 auto 1rem; }
        .match-history-item { background-color: rgba(0,0,0,0.1); border-radius: 0.5rem; padding: 0.75rem 1rem; }
    </style>
</head>
<body class="bg-gray-900">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <h1 class="text-4xl md:text-6xl font-black text-center text-white uppercase tracking-wider">The Rivalry</h1>
        <p class="text-center mt-2 text-2xl font-bold"><span class="text-red-500">KURD</span> vs <span class="text-green-500">ARAB</span></p>
        <p class="text-center mt-4"><a href="index.html" class="text-gray-400 hover:underline">‚Üê Back to Main Page</a></p>

        <!-- Main Comparison -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 mt-8 items-center">
            <div class="kurd-bg p-6 rounded-lg">
                <h2 class="text-3xl font-bold text-center">KURD</h2>
                <div class="grid grid-cols-3 gap-4 mt-4">
                    <div class="stat-card">
                        <p id="kurdWins" class="stat-value">0</p>
                        <p class="stat-label">Wins</p>
                    </div>
                    <div class="stat-card">
                        <p id="kurdGoals" class="stat-value">0</p>
                        <p class="stat-label">Goals</p>
                    </div>
                    <div class="stat-card">
                        <p id="kurdHonors" class="stat-value">0</p>
                        <p class="stat-label">Trophies</p>
                    </div>
                </div>
            </div>

            <div class="text-center text-5xl font-black text-gray-500">VS</div>

            <div class="arab-bg p-6 rounded-lg">
                <h2 class="text-3xl font-bold text-center">ARAB</h2>
                 <div class="grid grid-cols-3 gap-4 mt-4">
                    <div class="stat-card">
                        <p id="arabWins" class="stat-value">0</p>
                        <p class="stat-label">Wins</p>
                    </div>
                    <div class="stat-card">
                        <p id="arabGoals" class="stat-value">0</p>
                        <p class="stat-label">Goals</p>
                    </div>
                    <div class="stat-card">
                        <p id="arabHonors" class="stat-value">0</p>
                        <p class="stat-label">Trophies</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Star Players -->
        <div class="mt-8">
            <h2 class="text-3xl font-bold text-center">Star Players</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mt-4">
                <div id="kurdStar" class="player-card kurd-bg"></div>
                <div id="arabStar" class="player-card arab-bg"></div>
            </div>
        </div>

        <!-- Head to Head History -->
        <div class="mt-8">
            <h2 class="text-3xl font-bold text-center">Rivalry Match History</h2>
            <div id="rivalryHistory" class="mt-4 space-y-2 max-h-96 overflow-y-auto p-4 bg-black bg-opacity-20 rounded-lg">
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBvXdFou9yUlERH-iaICi6JjNChw1rC2O0",
          authDomain: "fun-league-6edd6.firebaseapp.com",
          projectId: "fun-league-6edd6",
          storageBucket: "fun-league-6edd6.appspot.com",
          messagingSenderId: "132854098604",
          appId: "1:132854098604:web:0c0e829ac99624dac38d09",
          measurementId: "G-QJCY28B9HM"
        };
        
        async function startApp() {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                await signInAnonymously(auth);
                const db = getFirestore(app);

                const playersSnapshot = await getDocs(collection(db, 'players'));
                const matchesSnapshot = await getDocs(query(collection(db, 'matches'), where('status', '==', 'completed')));
                const honorsSnapshot = await getDocs(collection(db, 'honors'));

                const allPlayers = playersSnapshot.docs.map(doc => doc.data());
                const allMatches = matchesSnapshot.docs.map(doc => doc.data());
                const allHonors = honorsSnapshot.docs.map(doc => doc.data());

                renderRivalryStats(allPlayers, allMatches, allHonors);

            } catch (error) {
                console.error("Error loading fun stats:", error);
            }
        }

        function renderRivalryStats(allPlayers, allMatches, allHonors) {
            const kurdPlayers = new Set(allPlayers.filter(p => p.nationality === 'Kurd').map(p => p.name));
            const arabPlayers = new Set(allPlayers.filter(p => p.nationality === 'Arab').map(p => p.name));

            const rivalryMatches = allMatches.filter(m => 
                (kurdPlayers.has(m.player1Name) && arabPlayers.has(m.player2Name)) ||
                (arabPlayers.has(m.player1Name) && kurdPlayers.has(m.player2Name))
            );

            let kurdWins = 0, arabWins = 0, kurdGoals = 0, arabGoals = 0;

            rivalryMatches.forEach(m => {
                if (kurdPlayers.has(m.player1Name)) { // Kurd is P1
                    kurdGoals += m.player1Goals;
                    arabGoals += m.player2Goals;
                    if (m.player1Goals > m.player2Goals) kurdWins++;
                    else if (m.player2Goals > m.player1Goals) arabWins++;
                } else { // Arab is P1
                    arabGoals += m.player1Goals;
                    kurdGoals += m.player2Goals;
                    if (m.player1Goals > m.player2Goals) arabWins++;
                    else if (m.player2Goals > m.player1Goals) kurdWins++;
                }
            });

            document.getElementById('kurdWins').textContent = kurdWins;
            document.getElementById('arabWins').textContent = arabWins;
            document.getElementById('kurdGoals').textContent = kurdGoals;
            document.getElementById('arabGoals').textContent = arabGoals;
            
            const kurdHonors = allHonors.filter(h => kurdPlayers.has(h.playerName)).length;
            const arabHonors = allHonors.filter(h => arabPlayers.has(h.playerName)).length;
            document.getElementById('kurdHonors').textContent = kurdHonors;
            document.getElementById('arabHonors').textContent = arabHonors;

            // Star Players
            const getStarPlayer = (playerSet) => {
                 let star = { name: 'N/A', wins: 0, avatarUrl: 'https://placehold.co/80x80/e9ecef/495057?text=?' };
                playerSet.forEach(playerName => {
                    const playerData = allPlayers.find(p => p.name === playerName);
                    const playerMatches = allMatches.filter(m => m.player1Name === playerName || m.player2Name === playerName);
                    const wins = playerMatches.filter(m => (m.player1Name === playerName && m.player1Goals > m.player2Goals) || (m.player2Name === playerName && m.player2Goals > m.player1Goals)).length;
                    if(wins > star.wins) {
                        star = { name: playerName, wins, avatarUrl: playerData.avatarUrl || star.avatarUrl };
                    }
                });
                return star;
            }

            const kurdStar = getStarPlayer(kurdPlayers);
            const arabStar = getStarPlayer(arabPlayers);

            document.getElementById('kurdStar').innerHTML = `
                <img src="${kurdStar.avatarUrl}" alt="${kurdStar.name}" class="player-avatar">
                <p class="text-xl font-bold">${kurdStar.name}</p>
                <p>${kurdStar.wins} Career Wins</p>`;
            document.getElementById('arabStar').innerHTML = `
                <img src="${arabStar.avatarUrl}" alt="${arabStar.name}" class="player-avatar">
                <p class="text-xl font-bold">${arabStar.name}</p>
                <p>${arabStar.wins} Career Wins</p>`;

            // History
            document.getElementById('rivalryHistory').innerHTML = rivalryMatches.sort((a,b) => b.timestamp - a.timestamp).map(m => `
                <div class="match-history-item text-center">
                    <p class="text-sm text-gray-400">${m.league}</p>
                    <p>${m.player1Name} <b class="text-xl">${m.player1Goals} - ${m.player2Goals}</b> ${m.player2Name}</p>
                </div>
            `).join('');

        }

        document.addEventListener('DOMContentLoaded', startApp);
    </script>
</body>
</html>
