<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun Stats - Kaka vs Habibi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');

      body {
        font-family: 'Inter', sans-serif;
        background-color: #f8f9fa;
        color: #333;
      }

      .container {
        max-width: 90%;
        margin: 2rem auto;
        padding: 2rem;
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 1rem;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
      }

      h1,
      h2,
      h3 {
        color: #00b894;
        text-align: center;
        font-weight: 700;
      }

      .kurd-card {
        background-color: #e42222;
        color: white;
      }

      .arab-card {
        background-color: #007a3d;
        color: white;
      }

      .stat-card {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
      }

      .stat-value {
        font-size: 3rem;
        font-weight: 900;
      }

      .stat-label {
        font-size: 1rem;
        opacity: 0.8;
      }

      .player-card {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 0.75rem;
        padding: 1rem;
        text-align: center;
      }

      .player-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #fff;
        margin: 0 auto 0.5rem;
      }

      .vs-graphic {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .vs-graphic svg {
        width: 50px;
        height: 50px;
        color: #6c757d;
      }

      .vs-graphic span {
        font-size: 3rem;
        font-weight: 900;
        color: #00b894;
      }

      .history-card {
        background-color: #fff;
        border-radius: 0.75rem;
        padding: 1.5rem;
        border: 1px solid #e9ecef;
      }

      .match-history-item {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        padding: 0.75rem;
        border-radius: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .winner {
        background-color: rgba(0, 184, 148, 0.1);
      }

      .loser {
        opacity: 0.6;
      }

      .score {
        font-weight: bold;
        font-size: 1.25rem;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-4xl md:text-6xl uppercase tracking-wider">El Clásico</h1>
      <p class="text-center mt-2 text-2xl font-bold">
        <span class="text-red-500">KAKA</span> vs <span class="text-green-500">HABIBI</span>
      </p>
      <p class="text-center mt-4">
        <a href="index.html" class="text-green-500 hover:underline">← Back to Main Page</a>
      </p>
      <!-- Main Comparison -->
      <div class="grid grid-cols-1 md:grid-cols-[1fr,auto,1fr] gap-4 md:gap-8 mt-8 items-center">
        <div class="kurd-card p-6 rounded-lg">
          <h2 class="text-3xl font-bold text-center">Kaka</h2>
          <div class="grid grid-cols-3 gap-4 mt-4">
            <div class="stat-card">
              <p id="kurdWins" class="stat-value">0</p>
              <p class="stat-label">Wins</p>
            </div>
            <div class="stat-card">
              <p id="kurdGoals" class="stat-value">0</p>
              <p class="stat-label">Goals</p>
            </div>
            <div class="stat-card">
              <p id="kurdHonors" class="stat-value">0</p>
              <p class="stat-label">Trophies</p>
            </div>
          </div>
        </div>
        <div class="vs-graphic">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12.0007 1.22937L21.3641 5.91104V11.2525C21.3641 15.688 17.5801 19.6896 12.0007 20.932C6.4213 19.6896 2.63733 15.688 2.63733 11.2525V5.91104L12.0007 1.22937ZM18.0007 11.2525H12.0007V18.102C15.8213 17.0673 18.0007 14.1843 18.0007 11.2525ZM12.0007 4.07267L5.88248 7.15939V11.2525C5.88248 14.1843 8.06187 17.0673 12.0007 18.102V4.07267Z"></path>
          </svg>
          <span>VS</span>
        </div>
        <div class="arab-card p-6 rounded-lg">
          <h2 class="text-3xl font-bold text-center">Habibi</h2>
          <div class="grid grid-cols-3 gap-4 mt-4">
            <div class="stat-card">
              <p id="arabWins" class="stat-value">0</p>
              <p class="stat-label">Wins</p>
            </div>
            <div class="stat-card">
              <p id="arabGoals" class="stat-value">0</p>
              <p class="stat-label">Goals</p>
            </div>
            <div class="stat-card">
              <p id="arabHonors" class="stat-value">0</p>
              <p class="stat-label">Trophies</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Star Players -->
      <div class="mt-8">
        <h2 class="text-3xl font-bold text-center text-gray-800">Star Players of the Rivalry</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mt-4">
          <div class="kurd-card p-4 rounded-lg">
            <div id="kurdStars" class="space-y-4"></div>
          </div>
          <div class="arab-card p-4 rounded-lg">
            <div id="arabStars" class="space-y-4"></div>
          </div>
        </div>
      </div>
      <!-- Head to Head History -->
      <div class="mt-8 history-card">
        <h2 class="text-3xl font-bold text-center">Top 10 Rivalry Wins</h2>
        <div id="rivalryHistory" class="mt-4 space-y-2 max-h-96 overflow-y-auto p-2"></div>
      </div>
    </div>
    <script type="module">
      import {
        initializeApp
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        getDocs,
        query,
        where
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
      const firebaseConfig = {
        apiKey: "AIzaSyBvXdFou9yUlERH-iaICi6JjNChw1rC2O0",
        authDomain: "fun-league-6edd6.firebaseapp.com",
        projectId: "fun-league-6edd6",
        storageBucket: "fun-league-6edd6.appspot.com",
        messagingSenderId: "132854098604",
        appId: "1:132854098604:web:0c0e829ac99624dac38d09",
        measurementId: "G-QJCY28B9HM"
      };
      async function startApp() {
        try {
          const app = initializeApp(firebaseConfig);
          const auth = getAuth(app);
          await signInAnonymously(auth);
          const db = getFirestore(app);
          const playersSnapshot = await getDocs(collection(db, 'players'));
          const matchesSnapshot = await getDocs(query(collection(db, 'matches'), where('status', '==', 'completed')));
          const honorsSnapshot = await getDocs(collection(db, 'honors'));
          const allPlayers = playersSnapshot.docs.map(doc => doc.data());
          const allMatches = matchesSnapshot.docs.map(doc => doc.data());
          const allHonors = honorsSnapshot.docs.map(doc => doc.data());
          renderRivalryStats(allPlayers, allMatches, allHonors);
        } catch (error) {
          console.error("Error loading fun stats:", error);
          document.querySelector('.container').innerHTML = `
					<h1 class="text-red-500">Error loading data. Check console.</h1>`;
        }
      }

      function renderRivalryStats(allPlayers, allMatches, allHonors) {
        const kurdPlayers = new Set(allPlayers.filter(p => p.nationality === 'Kurd').map(p => p.name));
        const arabPlayers = new Set(allPlayers.filter(p => p.nationality === 'Arab').map(p => p.name));
        const rivalryMatches = allMatches.filter(m => (kurdPlayers.has(m.player1Name) && arabPlayers.has(m.player2Name)) || (arabPlayers.has(m.player1Name) && kurdPlayers.has(m.player2Name)));
        let kurdWins = 0,
          arabWins = 0,
          kurdGoals = 0,
          arabGoals = 0;
        rivalryMatches.forEach(m => {
          if (kurdPlayers.has(m.player1Name)) { // Kurd is P1
            kurdGoals += m.player1Goals;
            arabGoals += m.player2Goals;
            if (m.player1Goals > m.player2Goals) kurdWins++;
            else if (m.player2Goals > m.player1Goals) arabWins++;
          } else { // Arab is P1
            arabGoals += m.player1Goals;
            kurdGoals += m.player2Goals;
            if (m.player1Goals > m.player2Goals) arabWins++;
            else if (m.player2Goals > m.player1Goals) kurdWins++;
          }
        });
        document.getElementById('kurdWins').textContent = kurdWins;
        document.getElementById('arabWins').textContent = arabWins;
        document.getElementById('kurdGoals').textContent = kurdGoals;
        document.getElementById('arabGoals').textContent = arabGoals;
        const kurdHonors = allHonors.filter(h => kurdPlayers.has(h.playerName)).length;
        const arabHonors = allHonors.filter(h => arabPlayers.has(h.playerName)).length;
        document.getElementById('kurdHonors').textContent = kurdHonors;
        document.getElementById('arabHonors').textContent = arabHonors;
        // Star Players based on rivalry wins
        const getStarPlayers = (playerSet, isKurd) => {
          return Array.from(playerSet).map(playerName => {
            const playerData = allPlayers.find(p => p.name === playerName);
            const wins = rivalryMatches.filter(m => (kurdPlayers.has(m.player1Name) && m.player1Name === playerName && m.player1Goals > m.player2Goals) || (kurdPlayers.has(m.player2Name) && m.player2Name === playerName && m.player2Goals > m.player1Goals) || (arabPlayers.has(m.player1Name) && m.player1Name === playerName && m.player1Goals > m.player2Goals) || (arabPlayers.has(m.player2Name) && m.player2Name === playerName && m.player2Goals > m.player1Goals)).length;
            return {
              name: playerName,
              wins,
              avatarUrl: playerData?.avatarUrl || 'https://placehold.co/80x80/e9ecef/495057?text=?'
            };
          }).sort((a, b) => b.wins - a.wins).slice(0, 3);
        }
        const kurdStars = getStarPlayers(kurdPlayers, true);
        const arabStars = getStarPlayers(arabPlayers, false);
        document.getElementById('kurdStars').innerHTML = kurdStars.map(star => `

					<div class="player-card">
						<img src="${star.avatarUrl}" alt="${star.name}" class="player-avatar">
							<p class="text-xl font-bold">${star.name}</p>
							<p>${star.wins} Rivalry Wins</p>
						</div>`).join('');
        document.getElementById('arabStars').innerHTML = arabStars.map(star => `

						<div class="player-card">
							<img src="${star.avatarUrl}" alt="${star.name}" class="player-avatar">
								<p class="text-xl font-bold">${star.name}</p>
								<p>${star.wins} Rivalry Wins</p>
							</div>`).join('');
        // History
        const top10Wins = rivalryMatches.filter(m => m.player1Goals !== m.player2Goals).sort((a, b) => Math.abs(b.player1Goals - b.player2Goals) - Math.abs(a.player1Goals - a.player2Goals)).slice(0, 10);
        document.getElementById('rivalryHistory').innerHTML = top10Wins.map(m => {
          const kurdIsP1 = kurdPlayers.has(m.player1Name);
          const kurdPlayerName = kurdIsP1 ? m.player1Name : m.player2Name;
          const arabPlayerName = kurdIsP1 ? m.player2Name : m.player1Name;
          const kurdGoals = kurdIsP1 ? m.player1Goals : m.player2Goals;
          const arabGoals = kurdIsP1 ? m.player2Goals : m.player1Goals;
          const kurdClass = kurdGoals > arabGoals ? 'winner' : 'loser';
          const arabClass = arabGoals > kurdGoals ? 'winner' : 'loser';
          return `

							<div class="match-history-item">
								<div class="${kurdClass} text-left">
									<span class="font-bold">${kurdPlayerName}</span>
								</div>
								<div class="score">${kurdGoals} - ${arabGoals}</div>
								<div class="${arabClass} text-right">
									<span class="font-bold">${arabPlayerName}</span>
								</div>
							</div>`
        }).join('') || ' < p class = "text-center text-gray-500" > No rivalry matches have been played yet. < /p>';
      }
      document.addEventListener('DOMContentLoaded', startApp);
    </script>
  </body>
</html>
