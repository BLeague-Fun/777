<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - FC 2025 League Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png');
            color: #c9d1d9;
        }
        .container {
            max-width: 90%;
            margin: 2rem auto;
            padding: 2rem;
            background-color: rgba(22, 27, 34, 0.85);
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        h1, h2 {
            color: #58a6ff;
            text-align: center;
            font-weight: 700;
        }
        .form-section {
            background-color: rgba(13, 17, 23, 0.9);
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
            border: 1px solid #30363d;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .form-section h2 {
            margin-top: 0;
            color: #c9d1d9;
            text-align: left;
        }
        input, button, select {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #30363d;
            background-color: #010409;
            color: #c9d1d9;
            transition: all 0.2s;
        }
        input:focus, button:hover, select:focus {
            border-color: #58a6ff;
            box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.5);
            outline: none;
        }
        button {
            background-color: #238636;
            color: white;
            font-weight: 500;
            cursor: pointer;
        }
        button:hover {
            background-color: #2ea043;
        }
        .delete-item-btn {
            background-color: transparent;
            border: none;
            color: #e54848;
            cursor: pointer;
            padding: 0.25rem;
            transition: color 0.2s;
        }
        .delete-item-btn:hover { color: #f25757; }
        .player-item, .league-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #30363d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-extrabold">Admin Panel</h1>
        <p class="text-center mt-2"><a href="index.html" class="text-blue-400 hover:underline">‚Üê Back to Main Page</a></p>

        <div class="form-section">
            <h2 class="text-2xl mb-4">Add a Match Result</h2>
            <form id="addMatchForm" class="grid grid-cols-1 md:grid-cols-6 gap-4 items-center">
                <select id="leagueSelect" required class="w-full"></select>
                <select id="player1Select" required class="w-full"></select>
                <input type="number" id="player1Goals" placeholder="Goals" required class="w-full text-center">
                <span class="text-center font-bold text-gray-500 text-lg">vs</span>
                <input type="number" id="player2Goals" placeholder="Goals" required class="w-full text-center">
                <select id="player2Select" required class="w-full"></select>
                <button type="submit" class="w-full md:col-span-6">Add Match</button>
            </form>
        </div>
        <div class="flex flex-col md:flex-row gap-4">
            <div class="form-section flex-1">
                <h2 class="text-2xl mb-4">Manage Players</h2>
                <form id="addPlayerForm" class="flex flex-col gap-4">
                    <input type="text" id="playerNameInput" placeholder="Player Name" required>
                    <button type="submit">Add Player</button>
                </form>
                <div id="playerList" class="mt-4 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="form-section flex-1">
                <h2 class="text-2xl mb-4">Manage Leagues</h2>
                <form id="addLeagueForm" class="flex flex-col gap-4">
                    <input type="text" id="leagueNameInput" placeholder="League Name" required>
                    <button type="submit">Add League</button>
                </form>
                <div id="leagueList" class="mt-4 max-h-60 overflow-y-auto"></div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBvXdFou9yUlERH-iaICi6JjNChw1rC2O0",
          authDomain: "fun-league-6edd6.firebaseapp.com",
          projectId: "fun-league-6edd6",
          storageBucket: "fun-league-6edd6.appspot.com",
          messagingSenderId: "132854098604",
          appId: "1:132854098604:web:0c0e829ac99624dac38d09",
          measurementId: "G-QJCY28B9HM"
        };
        
        const adminUID = "7ss4Z12tDkgCQB1pevK6gKR1WpI3";

        const addMatchForm = document.getElementById('addMatchForm');
        const player1Select = document.getElementById('player1Select');
        const player2Select = document.getElementById('player2Select');
        const leagueSelect = document.getElementById('leagueSelect');
        const addPlayerForm = document.getElementById('addPlayerForm');
        const addLeagueForm = document.getElementById('addLeagueForm');
        const playerListContainer = document.getElementById('playerList');
        const leagueListContainer = document.getElementById('leagueList');

        let db, auth, userId;
        let players = [], leagues = [];

        async function startApp() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                await signInAnonymously(auth);
                auth.onAuthStateChanged(user => {
                    if (user) {
                        userId = user.uid;
                        if (userId !== adminUID) {
                            document.body.innerHTML = '<div class="text-center text-red-500 p-8">Access Denied. You are not an administrator.</div>';
                            return;
                        }
                        setupListeners();
                    }
                });
            } catch (error) {
                console.error("Firebase initialization error:", error);
            }
        }
        
        function setupListeners() {
            onSnapshot(collection(db, 'players'), snapshot => {
                players = snapshot.docs.map(doc => doc.data().name);
                renderPlayerLists();
            });
            onSnapshot(collection(db, 'leagues'), snapshot => {
                leagues = snapshot.docs.map(doc => doc.data().name);
                renderLeagueLists();
            });
        }
        
        function renderPlayerLists() {
            const opts = players.map(p => `<option value="${p}">${p}</option>`).join('');
            player1Select.innerHTML = `<option value="">Select Player 1</option>${opts}`;
            player2Select.innerHTML = `<option value="">Select Player 2</option>${opts}`;
            playerListContainer.innerHTML = players.map(p => `<div class="player-item"><span>${p}</span><button data-name="${p}" data-type="player" class="delete-item-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg></button></div>`).join('') || '<p>No players added yet.</p>';
        }
        
        function renderLeagueLists() {
            leagueSelect.innerHTML = `<option value="">Select League</option>${leagues.map(l => `<option value="${l}">${l}</option>`).join('')}`;
            leagueListContainer.innerHTML = leagues.map(l => `<div class="league-item"><span>${l}</span><button data-name="${l}" data-type="league" class="delete-item-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg></button></div>`).join('') || '<p>No leagues added yet.</p>';
        }

        document.addEventListener('click', async (e) => {
            const btn = e.target.closest('.delete-item-btn');
            if (btn) {
                const { name, type } = btn.dataset;
                if(confirm(`Are you sure you want to delete this ${type}: ${name}?`)) {
                    const q = query(collection(db, `${type}s`), where("name", "==", name));
                    const snapshot = await getDocs(q);
                    snapshot.forEach(d => deleteDoc(d.ref));
                }
            }
        });

        addPlayerForm.addEventListener('submit', async e => { e.preventDefault(); const pName = document.getElementById('playerNameInput').value.trim(); if (pName && !players.includes(pName)) { await addDoc(collection(db, 'players'), { name: pName, owner: userId }); addPlayerForm.reset(); } });
        addLeagueForm.addEventListener('submit', async e => { e.preventDefault(); const lName = document.getElementById('leagueNameInput').value.trim(); if (lName && !leagues.includes(lName)) { await addDoc(collection(db, 'leagues'), { name: lName, owner: userId }); addLeagueForm.reset(); } });
        addMatchForm.addEventListener('submit', async e => { e.preventDefault(); const l = leagueSelect.value, p1 = player1Select.value, g1 = parseInt(document.getElementById('player1Goals').value), p2 = player2Select.value, g2 = parseInt(document.getElementById('player2Goals').value); if (l && p1 && p2 && !isNaN(g1) && !isNaN(g2) && p1 !== p2) { await addDoc(collection(db, 'matches'), { league:l, player1Name:p1, player1Goals:g1, player2Name:p2, player2Goals:g2, timestamp: Date.now(), isMOTW: false }); addMatchForm.reset(); } });
        
        document.addEventListener('DOMContentLoaded', startApp);
    </script>
</body>
</html>
